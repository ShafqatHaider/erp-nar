 <!-- <div class="bg-white rounded-lg shadow-md p-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold text-gray-800">Sale Items</h2>
        <div class="text-sm text-gray-600">
          Total Items: {{ saleItems?.length || 0 }} | 
          Selected: {{ getSelectedItemsCount() }}
        </div>
      </div>


      <app-loading-spinner *ngIf="isLoading" [text]="'Loading items...'"></app-loading-spinner>


      <div *ngIf="!isLoading && saleItems && saleItems.length > 0">

        <div class="flex items-center justify-between mb-4">
          <div>
            <h3 class="text-lg font-semibold text-gray-900">Sales Items Grid</h3>
            <p class="text-sm text-gray-500 mt-1">
              {{ getSelectedItemsCount() }} item(s) with quantity added • 
              {{ saleItems.length }} total items available
            </p>
          </div>
          <span class="text-sm text-gray-500 bg-blue-50 px-3 py-1 rounded-full">
            Add quantity to items you want to sale
          </span>
        </div>


        <div class="border border-gray-200 rounded-lg overflow-hidden">
          <div class="overflow-x-auto">
            <table class="w-full min-w-full">
              <thead class="bg-gray-50 border-b border-gray-200">
                <tr>
                  <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20%">
                    Item Details
                  </th>
                  <th class="px-6 py-4 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                    TP Rate
                  </th>
                  <th class="px-6 py-4 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Percentage %
                  </th>
                  <th class="px-6 py-4 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Stock
                  </th>
                  <th class="px-6 py-4 text-right text-xs font-medium text-gray-500 uppercase tracking-wider w-20">
                    Quantity
                  </th>
                  <th class="px-6 py-4 text-right text-xs font-medium text-gray-500 uppercase tracking-wider w-20">
                    Rate
                  </th>
                  <th class="px-6 py-4 text-right text-xs font-medium text-gray-500 uppercase tracking-wider w-20">
                    Amount
                  </th>
                </tr>
              </thead>
              <tbody [formArray]="saleItems" class="bg-white divide-y divide-gray-200">
                <tr *ngFor="let item of saleItems.controls; let i = index" 
                    [formGroup]="getItemGroup(i)"
                    class="hover:bg-gray-50 transition-colors" 
                    [class.bg-green-50]="(getItemGroup(i).get('qty')?.value || 0) > 0">
                  
                 
                  <td class="px-6 py-4">
                    <div>
                      <div class="font-medium text-gray-900">
                        {{ getItemGroup(i).get('itemName')?.value }}
                      </div>
                      <div class="text-sm text-gray-500">
                        {{ getItemGroup(i).get('productCode')?.value }}
                      </div>
                    </div>
                    <div *ngIf="(getItemGroup(i).get('qty')?.value || 0) > 0"
                      class="text-xs text-green-600 font-medium mt-1 flex items-center">
                      <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                          d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                          clip-rule="evenodd"></path>
                      </svg>
                      Included in sale
                    </div>
                  </td>

                 
                  <td class="px-6 py-4 text-right text-sm text-gray-600">
                    {{ getItemGroup(i).get('lastPurchaseRate')?.value | number:'1.2-2' }}
                  </td>

                 
                  <td class="px-6 py-4 text-right">
                    {{ getItemGroup(i).get('percentage')?.value }}
                  </td>

                 
                  <td class="px-6 py-4 text-right text-sm text-gray-600">
                    {{ getItemGroup(i).get('currentStock')?.value | number:'1.0-0' }}
                  </td>

                 
                  <td class="px-6 py-4">
                    <input 
                      type="number" 
                      [formControl]="getItemGroup(i).get('qty')"
                      #qtyInput
                      (focus)="selectAll($event.target)"
                      (keydown.arrowdown)="$event.preventDefault(); focusNextQty(i)"
                      (keydown.arrowup)="$event.preventDefault(); focusPrevQty(i)"
                      class="w-24 px-3 py-2 border rounded text-right focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                      [class]="(getItemGroup(i).get('qty')?.value || 0) > 0 ? 'border-green-300 bg-green-50' : 'border-gray-300'"
                      min="0"
                      placeholder="0"
                    >
                    <div *ngIf="getItemGroup(i).get('qty')?.invalid && getItemGroup(i).get('qty')?.touched" 
                         class="text-red-600 text-xs mt-1">
                      Quantity must be positive
                    </div>
                  </td>

                 
                  <td class="px-6 py-4">
                    <div class="relative">
                      <input 
                        type="number" 
                        [formControl]="getItemGroup(i).get('rate')"
                        class="w-24 px-3 py-2 border rounded text-right focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors pl-6"
                        [class]="(getItemGroup(i).get('qty')?.value || 0) > 0 ? 'border-green-300 bg-green-50' : 'border-gray-300'"
                        step="0.01" 
                        min="0" 
                        placeholder="0.00"
                        readonly
                      >
                      <div class="absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400 text-xs">
                        Rs.
                      </div>
                    </div>
                  </td>

                 
                  <td class="px-6 py-4 text-right">
                    <div class="relative">
                      <input 
                        type="number" 
                        [formControl]="getItemGroup(i).get('lineAmount')"
                        class="w-32 px-3 py-2 border rounded text-gray-600 font-medium text-right pr-6 bg-gray-50"
                        readonly
                      >
                      <div class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 text-xs">
                        Rs.
                      </div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        
        <div class="mt-6 pt-4 border-t border-gray-200">
          <div class="flex justify-between items-center">
            <span class="text-lg font-semibold text-gray-800">Total Amount:</span>
            <span class="text-2xl font-bold text-blue-600">
              Rs. {{ getTotalAmount() | number:'1.2-2' }}
            </span>
          </div>
        </div>

        
        <div class="mt-4 p-4 bg-blue-50 rounded-lg">
          <div class="flex items-start">
            <svg class="w-5 h-5 text-blue-600 mr-2 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div>
              <p class="text-sm text-blue-700">
                <strong>Note:</strong> Only items with quantity greater than 0 will be included in the sale.
                Use arrow keys (↑↓) to navigate between quantity fields quickly.
              </p>
            </div>
          </div>
        </div>
      </div>

      
      <div *ngIf="!isLoading && (!saleItems || saleItems.length === 0)" 
           class="text-center py-12 border-2 border-dashed border-gray-300 rounded-lg">
        <svg class="w-12 h-12 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4">
          </path>
        </svg>
        <h3 class="text-lg font-medium text-gray-900 mb-2">No items available</h3>
        <p class="text-gray-500 mb-4">There are no items to display.</p>
      </div>
    </div> -->